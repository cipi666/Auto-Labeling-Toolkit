# SAM è‡ªåŠ¨æ ‡æ³¨å·¥å…·ç®± (SAM Auto-Labeling Toolkit)

æœ¬é¡¹ç›®é›†æˆ **SAM (Segment Anything Model)** ç³»åˆ—æ¨¡å‹ï¼Œæä¾›å¤šç§è‡ªåŠ¨æ ‡æ³¨æ–¹æ¡ˆã€‚åŒ…å«åŸºäºé¢œè‰²ç‰¹å¾çš„é€šç”¨æ ‡æ³¨å·¥å…·å’ŒåŸºäºæ–‡æœ¬æç¤ºçš„ç‰¹å®šä»»åŠ¡ï¼ˆäº”è¾¹å½¢é¶æ ‡ï¼‰æ ‡æ³¨å·¥å…·ã€‚

## ğŸ› ï¸ æ ¸å¿ƒå·¥å…·

### 1. é€šç”¨è‡ªåŠ¨æ ‡æ³¨ (`auto_label.py`)
åˆ©ç”¨ **SAM 3** çš„å¼ºå¤§æ–‡æœ¬æç¤ºèƒ½åŠ›ï¼Œå¿«é€Ÿç”Ÿæˆç›®æ ‡æ£€æµ‹æ•°æ®ã€‚
- **å·¥ä½œæµ**ï¼šæ–‡æœ¬æç¤º (Text Prompt) -> SAM 3 åˆ†å‰² -> å¤–æ¥çŸ©å½¢æ¡† (Bounding Box)ã€‚
- **åº”ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºæ„å»º YOLO æ£€æµ‹æ•°æ®é›†ï¼Œæ— éœ€ç‰¹å®šå‡ ä½•å½¢çŠ¶ã€‚
- **è¾“å‡ºæ ¼å¼**ï¼šæ ‡å‡† YOLO æ£€æµ‹æ ¼å¼ (`class_id x_center y_center width height`)ã€‚

### 2. ç‰¹å®šä»»åŠ¡æ ‡æ³¨ (`sam3_auto_label.py`)
ä¸“é—¨é’ˆå¯¹**äº”è¾¹å½¢é¶æ ‡**ä»»åŠ¡è®¾è®¡ï¼Œåˆ©ç”¨ SAM 3 è¿›è¡Œç²¾ç»†åˆ†å‰²å’Œå…³é”®ç‚¹æ’åºã€‚
- **å‡ ä½•æ„ŸçŸ¥æ’åº**ï¼šè‡ªåŠ¨å°†åˆ†å‰² Mask æ‹Ÿåˆä¸º 5 ä¸ªæœ‰åºé¡¶ç‚¹ã€‚
  - **Index 0**ï¼šäº”è¾¹å½¢é¡¶ç‚¹ï¼ˆæœ€é«˜ç‚¹ï¼‰ã€‚
  - **Index 1-4**ï¼šé¡ºæ—¶é’ˆæ’åˆ—ã€‚
- **è¾“å‡ºæ ¼å¼**ï¼šYOLO å…³é”®ç‚¹/åˆ†å‰²æ ¼å¼ (`class_id x1 y1 x2 y2 x3 y3 x4 y4 x5 y5`)ã€‚

### 3. æç¤ºè¯æµ‹è¯•å®éªŒ (`prompt_experiment.py`)
åœ¨æ­£å¼æ ‡æ³¨å‰ï¼Œç”¨äºå¿«é€Ÿæµ‹è¯•ä¸åŒæ–‡æœ¬æç¤ºè¯ï¼ˆPromptï¼‰çš„æ•ˆæœã€‚
- **åŠŸèƒ½**ï¼šå¯¹å•å¼ å›¾ç‰‡æµ‹è¯•ä¸€ç»„é¢„è®¾çš„ Promptï¼Œç»Ÿè®¡æ¯ä¸ª Prompt èƒ½æ£€å‡ºçš„ Mask æ•°é‡ã€‚
- **ç”¨é€”**ï¼šå¸®åŠ©ç”¨æˆ·ç­›é€‰å‡ºæœ€é€‚åˆå½“å‰æ•°æ®é›†çš„ Promptï¼ˆä¾‹å¦‚ "red target" vs "pentagon"ï¼‰ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ auto_label.py            # é€šç”¨è„šæœ¬ï¼šæ–‡æœ¬æç¤º -> BBox æ ‡æ³¨ (æ¨è)
â”œâ”€â”€ sam3_auto_label.py       # ç‰¹å®šè„šæœ¬ï¼šæ–‡æœ¬æç¤º -> æœ‰åºäº”è¾¹å½¢æ ‡ç­¾
â”œâ”€â”€ prompt_experiment.py     # å®éªŒè„šæœ¬ï¼šæµ‹è¯• Prompt æ•ˆæœ
â”œâ”€â”€ sam3.pt                  # SAM 3 æ¨¡å‹æƒé‡
â”œâ”€â”€ sam3/                    # SAM 3 æºç åº“
â”œâ”€â”€ images/                  # è¾“å…¥å›¾ç‰‡æ–‡ä»¶å¤¹ (è¾“å‡ºçš„ .txt æ ‡ç­¾ä¹Ÿåœ¨æ­¤)
â”œâ”€â”€ output_auto_label_vis/   # auto_label.py çš„å¯è§†åŒ–ç»“æœ
â””â”€â”€ output_sam3_vis/         # sam3_auto_label.py çš„å¯è§†åŒ–ç»“æœ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
pip install torch torchvision opencv-python pillow tqdm
cd sam3
pip install -e .
cd ..
```

### 2. æŒ‘é€‰æœ€ä½³ Prompt (å¯é€‰)
å¦‚æœä¸ç¡®å®šç”¨ä»€ä¹ˆæç¤ºè¯ï¼Œå¯ä»¥å…ˆè¿è¡Œå®éªŒï¼š
```bash
python prompt_experiment.py
```
æŸ¥çœ‹è¾“å‡ºç»“æœï¼Œé€‰æ‹©èƒ½ç¨³å®šæ£€å‡ºç›®æ ‡çš„è¯ã€‚

### 3. è¿è¡Œé€šç”¨æ ‡æ³¨ (BBox)
```bash
# é»˜è®¤å¯»æ‰¾ "target"
python auto_label.py

# è‡ªå®šä¹‰ Prompt å’Œç±»åˆ« ID
python auto_label.py --prompt "red car" --class_id 2 --conf_thresh 0.3
```
- ç»“æœä¿å­˜åœ¨ `images/` (txt) å’Œ `output_auto_label_vis/` (å¯è§†åŒ–)ã€‚

### 4. è¿è¡Œç‰¹å®šä»»åŠ¡æ ‡æ³¨ (äº”è¾¹å½¢)
é’ˆå¯¹éœ€è¦è¯†åˆ«â€œäº”è¾¹å½¢â€å¹¶æ’åºçš„ä»»åŠ¡ï¼š
```bash
python sam3_auto_label.py --prompt "pentagonal sign" --conf_thresh 0.5
```

## ğŸ“Š æ ‡æ³¨ç»“æœæ ¡éªŒ
*   **auto_label.py**ï¼šæ£€æŸ¥ `output_auto_label_vis/` ä¸‹çš„ç»¿è‰²çŸ©å½¢æ¡†ã€‚
*   **sam3_auto_label.py**ï¼šæ£€æŸ¥ `output_sam3_vis/` ä¸‹çš„çº¢è‰²å¤§ç‚¹æ˜¯å¦åœ¨äº”è¾¹å½¢é¡¶éƒ¨ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹
- `auto_label.py` é»˜è®¤ä½¿ç”¨ CPU æ¨ç†ï¼ˆé€‚åˆ Tiny æ¨¡å‹ï¼‰ï¼Œå¦‚éœ€åŠ é€Ÿå¯ä¿®æ”¹è„šæœ¬ä¸­çš„ `DEVICE = "cuda"`ã€‚
- `sam3_auto_label.py` éœ€è¦ `sam3.pt` æƒé‡æ–‡ä»¶ã€‚
